<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Science & AI Brief</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#0e1420; --panel-2:#0a1220; --text:#e9f1ff; --muted:#9fb2cc;
    --border:#1b2a40; --brand:#7dd3fc; --brand-2:#a78bfa; --ok:#22c55e; --warn:#f59e0b;
    --chip:#122136; --chip-active:#1e293b; --accent:#60a5fa; --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#0a0f15,#0b1220 55%,#0a0f15);color:var(--text);
       font:14.5px/1.45 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;}
  a{color:#bfe0ff;text-decoration:none} a:hover{text-decoration:underline}
  /* Header */
  header{position:sticky;top:0;z-index:5;background:rgba(10,16,26,.7);backdrop-filter:blur(8px);
         border-bottom:1px solid var(--border)}
  .wrap{max-width:1280px;margin:0 auto;padding:16px 18px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  h1{margin:0;font-size:20px;letter-spacing:.3px}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--border);
        border-radius:999px;background:#0c1829;color:#cfe3ff;font-size:12px}
  /* Layout */
  .layout{display:grid;grid-template-columns:270px 1fr;gap:18px;margin-top:16px}
  @media (max-width:980px){.layout{grid-template-columns:1fr}}
  /* Sidebar */
  .side{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:12px}
  .group{margin-bottom:10px}
  .group h3{margin:12px 8px 6px;font-size:12px;text-transform:uppercase;color:var(--muted);letter-spacing:.12em}
  .chip{display:flex;justify-content:space-between;align-items:center;gap:8px;padding:8px 10px;border-radius:10px;
        background:var(--chip);border:1px solid var(--border);cursor:pointer;margin:6px 0;color:#d7e7ff}
  .chip[data-active="1"]{background:var(--chip-active);font-weight:700}
  .chip small{opacity:.75}
  .sub{padding-left:12px}
  .sub .chip{background:#0f1b2c}
  /* Tools */
  .tools{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .input,.select,.btn{background:#0a1525;border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:10px}
  .input{min-width:260px}
  .btn{cursor:pointer}
  .btn.primary{background:#0f233a;border-color:#133558}
  .btn.ghost{background:#0c1828}
  .toggle{display:inline-flex;align-items:center;gap:8px;padding:10px;border:1px solid var(--border);border-radius:10px;background:#0a1525}
  /* Highlights */
  .high{background:linear-gradient(135deg, rgba(14,165,233,.12), rgba(168,85,247,.12));
        border:1px solid var(--border);border-radius:var(--radius);padding:14px;margin-bottom:14px}
  .high .title{display:flex;align-items:center;gap:10px;font-weight:800}
  .highgrid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
  @media (max-width:900px){.highgrid{grid-template-columns:1fr}}
  .hcard{background:#0a1322;border:1px solid var(--border);border-radius:12px;padding:10px}
  .hcard .tag{font-size:11px;color:#9cc7ff}
  .hcard .ttl{margin:4px 0;font-weight:700}
  /* Cards & grid */
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
  @media (max-width:1200px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:760px){.grid{grid-template-columns:1fr}}
  .card{background:var(--panel-2);border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:var(--shadow)}
  .meta{display:flex;gap:8px;flex-wrap:wrap;color:var(--muted);font-size:12px;margin-bottom:6px}
  .badge{padding:2px 8px;border-radius:999px;background:#0e2037;border:1px solid var(--border);color:#cfe3ff}
  .c-title{margin:6px 0 6px;font-weight:700}
  .desc{color:#d7e7ff}
  .muted{color:var(--muted)}
  .foot{margin-top:10px;display:flex;justify-content:space-between;align-items:center}
  .btn.sm{padding:6px 8px}
  /* collapse */
  details summary{cursor:pointer;list-style:none}
  details summary::-webkit-details-marker{display:none}
  details .more{margin-top:8px;color:#c9dbf7}
  /* Pagination */
  .pager{display:flex;gap:8px;justify-content:center;margin:18px 0}
  .pagebtn{padding:8px 10px;border:1px solid var(--border);background:#0c1828;border-radius:10px;color:#cfe3ff;cursor:pointer}
  .pagebtn[disabled]{opacity:.5;cursor:not-allowed}
  footer{border-top:1px solid var(--border);margin-top:24px;color:var(--muted)}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="row">
      <h1>üß† Science & AI Brief</h1>
      <div class="pill" id="statusPill">loading‚Ä¶</div>
      <div class="pill" id="countPill">0 items</div>
    </div>
    <div class="row tools">
      <input class="input" id="q" placeholder="Search titles & summaries‚Ä¶" />
      <select class="select" id="sort">
        <option value="score">Sort: Top score</option>
        <option value="date">Sort: Newest</option>
        <option value="alpha">Sort: A ‚Üí Z</option>
      </select>
      <label class="toggle"><input type="checkbox" id="plain" /> Plain English</label>
      <label class="toggle"><input type="checkbox" id="compact" /> Compact</label>
      <button class="btn ghost" id="toggleAI">AI regroup (optional)</button>
      <button class="btn primary" id="resetAI" style="display:none">Reset groups</button>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="layout">
    <aside class="side" id="sidebar">
      <!-- dynamic category tree -->
    </aside>

    <section>
      <!-- Highlights -->
      <section class="high" id="high">
        <div class="title">‚≠ê Top Highlights <span class="muted">(plain takeaways)</span></div>
        <div class="highgrid" id="highGrid"></div>
      </section>
      <!-- Cards -->
      <section class="grid" id="grid"></section>
      <div class="pager" id="pager"></div>
    </section>
  </div>
</main>

<footer class="wrap muted" style="padding-bottom:36px">UI-only. Reads <code>docs/daily.json</code>. No pipeline changes.</footer>

<script>
/* -------------------- State -------------------- */
const S = {
  data:null, items:[], tree:{}, order:[],
  activeMain:'All', activeSub:'', q:'', sort:'score', plain:false, compact:false,
  page:1, perPage:12,
  backupGroups:null, // for reset after AI regroup
};

/* -------------------- Utils -------------------- */
const $ = s => document.querySelector(s);
function setStatus(j){ $('#statusPill').textContent = j ? `ok ‚Ä¢ ${j.generated_at||''}` : '‚Äî'; }
function setCount(n){ $('#countPill').textContent = `${n} items`; }
function byScore(a,b){ return (b.score||0)-(a.score||0); }
function byDate(a,b){ return new Date(b.date||b.published||0)-new Date(a.date||a.published||0); }
function byAlpha(a,b){ return (a.title||'').localeCompare(b.title||''); }
function simplify(t){
  if(!t) return ''; let s=String(t);
  const swaps=[[/(state[- ]of[- ]the[- ]art)/gi,'best so far'],[/\bnovel\b|\binnovative\b|\bpropose(d)?\b/gi,'new'],
               [/\bframework\b|\barchitecture\b/gi,'system'],[/benchmarks?/gi,'tests'],
               [/datasets?/gi,'data'],[/significant(ly)?/gi,'a lot'],
               [/outperform(s|ed)?/gi,'does better than'],[/demonstrate(s|d)?/gi,'shows'],[/achieve(s|d)?/gi,'gets']];
  swaps.forEach(([a,b])=>s=s.replace(a,b)); s=s.replace(/\s+/g,' ').trim(); if(s.length>220) s=s.slice(0,217)+'‚Ä¶'; return s;
}

/* -------- Heuristic category ‚Üí subcategory map (fallback) -------- */
function keywordBuckets(it){
  const t = (it.title+' '+(it.summary||it.abstract||'')).toLowerCase();
  const m = it.group || it.category || 'General';
  let sub='General';
  const tests = [
    ['AI/ML','Reasoning',['reason','chain-of-thought','cot','tool','agent','planner','math','solve']],
    ['AI/ML','Multimodal',['vision','image','video','audio','speech','clip','mm','vlm','llava','gpt-4o']],
    ['AI/ML','Efficiency',['quantization','distill','prune','efficient','compress','lossless']],
    ['AI/ML','Safety & Eval',['safety','alignment','eval','benchmark','human eval','bias']],
    ['AI/ML','RAG & Retrieval',['rag','retrieval','index','chunk','vector','memory']],
    ['Robotics','Manipulation',['manipulation','grasp','arm','pick','place']],
    ['Robotics','Navigation',['nav','slam','localization','waypoint','map','trajectory']],
    ['Biotech','Genomics',['genome','gene','crispr','rna','protein']],
    ['Biotech','Health AI',['medical','health','diagnosis','radiology','ct','mri']],
    ['Systems','Hardware',['gpu','accelerator','edge','chip','fpga','asic']],
    ['Systems','Data/Infra',['pipeline','dataset','storage','infra','throughput']],
  ];
  for(const [main,subName,words] of tests){
    if((m===main||m===subName||m==='All') && words.some(w=>t.includes(w))) return {main,sub:subName};
  }
  return {main:m, sub};
}

/* -------------------- Build category tree -------------------- */
function buildTree(items){
  const tree={'All':{}};
  for(const it of items){
    const guess = keywordBuckets(it);
    const main = guess.main || 'General';
    const sub  = guess.sub  || 'General';
    if(!tree[main]) tree[main]={};
    if(!tree[main][sub]) tree[main][sub]=0;
    tree[main][sub]++; // count
    // also keep All
    if(!tree['All'][main]) tree['All'][main]=0;
    tree['All'][main]++;
  }
  S.tree = tree;
  S.order = Object.keys(tree).filter(k=>k!=='All').sort();
}

/* -------------------- Sidebar render -------------------- */
function renderSidebar(){
  const el=$('#sidebar'); el.innerHTML='';
  // Main
  const makeChip=(txt,count,active,onclick)=> {
    const d=document.createElement('div'); d.className='chip'; d.dataset.active=active?'1':'0';
    d.innerHTML=`<span>${txt}</span><small>${count}</small>`; d.onclick=onclick; return d;
  };
  // All section
  const gAll=document.createElement('div'); gAll.className='group';
  gAll.innerHTML='<h3>Explore</h3>'; gAll.appendChild(makeChip('All', S.items.length, S.activeMain==='All', ()=>{S.activeMain='All'; S.activeSub=''; S.page=1; render();}));
  // top-level list inside All (as subs)
  const subWrap=document.createElement('div'); subWrap.className='sub';
  for(const [cat,count] of Object.entries(S.tree['All']).sort((a,b)=>b[1]-a[1])){
    subWrap.appendChild(makeChip(cat,count, S.activeMain==='All' && S.activeSub===cat, ()=>{
      S.activeMain='All'; S.activeSub=cat; S.page=1; render();
    }));
  }
  gAll.appendChild(subWrap); el.appendChild(gAll);

  // Each main
  for(const main of S.order){
    const g=document.createElement('div'); g.className='group';
    g.innerHTML=`<h3>${main}</h3>`;
    g.appendChild(makeChip(main, Object.values(S.tree[main]).reduce((a,b)=>a+b,0), S.activeMain===main && !S.activeSub, ()=>{
      S.activeMain=main; S.activeSub=''; S.page=1; render();
    }));
    const sub=document.createElement('div'); sub.className='sub';
    for(const [subcat,count] of Object.entries(S.tree[main]).sort((a,b)=>b[1]-a[1])){
      sub.appendChild(makeChip(subcat,count, S.activeMain===main && S.activeSub===subcat, ()=>{
        S.activeMain=main; S.activeSub=subcat; S.page=1; render();
      }));
    }
    g.appendChild(sub); el.appendChild(g);
  }
}

/* -------------------- Highlights -------------------- */
function pickHighlights(items){
  const arr=[...items].sort(byScore); return (arr[0]?.score?arr:[...items].sort(byDate)).slice(0,6);
}
function renderHighlights(items){
  const hg=$('#highGrid'); hg.innerHTML='';
  for(const it of pickHighlights(items)){
    const url=it.url||it.link||'#';
    const plain=simplify(it.summary||it.desc||it.abstract||it.title||'');
    const el=document.createElement('div'); el.className='hcard';
    el.innerHTML=`<div class="tag">${it.group||it.category||'General'}</div>
      <div class="ttl"><a href="${url}" target="_blank" rel="noopener">${it.title||'(untitled)'}</a></div>
      <div class="plain">${plain}</div>`;
    hg.appendChild(el);
  }
}

/* -------------------- Cards + pagination -------------------- */
function makeCard(it){
  const div=document.createElement('article'); div.className='card'; if(S.compact) div.style.padding='12px';
  const cat=it.group||it.category||''; const src=it.source||it.url_domain||it.domain||'';
  const date=it.date||it.published||''; const score=it.score??(it.rank||null);
  const sum=S.plain ? simplify(it.summary||it.desc||it.abstract||'') : (it.summary||it.desc||it.abstract||'');
  const more=(it.content||it.abstract_long||'');
  div.innerHTML=`
    <div class="meta">
      <span class="badge">${cat||'‚Äî'}</span>
      ${date?`<span>${new Date(date).toLocaleDateString()}</span>`:''}
      ${src?`<span>‚Ä¢ ${src}</span>`:''}
    </div>
    <div class="c-title"><a href="${it.url||it.link||'#'}" target="_blank" rel="noopener">${it.title||'(untitled)'}</a></div>
    ${sum?`<div class="desc">${sum}</div>`:''}
    <div class="foot">
      <span class="muted">${score!=null?`Score: ${score}`:''}</span>
      <details><summary class="btn sm">Details</summary><div class="more">${(more||'No extra details.').replace(/\n/g,'<br>')}</div></details>
    </div>`;
  return div;
}
function page(list){
  const start=(S.page-1)*S.perPage; return list.slice(start, start+S.perPage);
}
function renderPager(total){
  const pages=Math.max(1, Math.ceil(total/S.perPage));
  const el=$('#pager'); el.innerHTML='';
  const mk=(txt,dis,fn)=>{const b=document.createElement('button'); b.className='pagebtn'; b.textContent=txt; b.disabled=!!dis; b.onclick=fn; return b;}
  el.appendChild(mk('¬´', S.page===1, ()=>{S.page=1; render();}));
  el.appendChild(mk('‚Äπ', S.page===1, ()=>{S.page--; render();}));
  el.appendChild(document.createTextNode(` Page ${S.page}/${pages} `));
  el.appendChild(mk('‚Ä∫', S.page>=pages, ()=>{S.page++; render();}));
  el.appendChild(mk('¬ª', S.page>=pages, ()=>{S.page=pages; render();}));
}

/* -------------------- Render pipeline -------------------- */
function render(){
  // filter
  const q=S.q.trim().toLowerCase();
  let list=S.items.filter(it=>{
    const inMain = (S.activeMain==='All') ? true : ((it.group||it.category||'')===S.activeMain);
    const inSub  = !S.activeSub ? true :
      (S.activeMain==='All' ? ((it.group||it.category||'')===S.activeSub) : (keywordBuckets(it).sub===S.activeSub));
    const inQ=!q || [it.title,it.summary,it.desc,it.abstract,it.source,it.url_domain].filter(Boolean)
                .some(s=>String(s).toLowerCase().includes(q));
    return inMain && inSub && inQ;
  });
  // sort
  if(S.sort==='score') list.sort(byScore); else if(S.sort==='date') list.sort(byDate); else list.sort(byAlpha);
  // render
  $('#grid').innerHTML=''; page(list).forEach(it=>$('#grid').appendChild(makeCard(it)));
  setCount(list.length);
  renderPager(list.length);
  renderHighlights(S.items);
  renderSidebar(); // refresh counts
}

/* -------------------- AI regroup (optional) -------------------- */
/* This runs only if you explicitly click ‚ÄúAI regroup‚Äù and provide an API key.
   The key is stored in memory for this tab only. */
let AI_KEY = null;
async function aiRegroup(items){
  if(!AI_KEY){ AI_KEY = prompt("Enter OpenAI API key (kept only in memory for this tab). Cancel to abort."); }
  if(!AI_KEY) return;

  const model = "gpt-4o-mini";
  // batch titles+briefs to avoid long prompts
  const chunk = (arr,n)=>arr.reduce((a,c,i)=>(i%n?a[a.length-1].push(c):a.push([c]),a),[]);
  const batches = chunk(items.map((it,i)=>({i,title:it.title,summary:(it.summary||it.abstract||'')})), 32);

  const mapping = {};
  for(const batch of batches){
    const prompt = `You are organizing research/news items into (Main Category, Subcategory).
Main categories to choose from or propose (keep list concise, professional):
AI/ML, Robotics, Biotech, Systems, Theory, Tools, Data, Applications, Policy, General.
Create a JSON array of objects {index, main, sub}. Sub should be short (e.g., "Reasoning", "Multimodal", "RAG", "Safety", "Genomics", etc.).
Items:
${batch.map(x=>`- [${x.i}] ${x.title}\n  ${x.summary}`).join('\n')}`;
    try{
      const r = await fetch("https://api.openai.com/v1/chat/completions",{
        method:"POST",
        headers:{ "Content-Type":"application/json", "Authorization":"Bearer "+AI_KEY },
        body: JSON.stringify({
          model, temperature:0.2,
          messages:[{role:"system",content:"Return only valid compact JSON."},{role:"user",content:prompt}]
        })
      });
      const j = await r.json();
      const text = j.choices?.[0]?.message?.content?.trim() || "[]";
      const arr = JSON.parse(text);
      for(const e of arr){ mapping[e.index]={main:e.main, sub:e.sub}; }
    }catch(e){ console.error(e); alert("AI regroup failed on one batch; using heuristics for those."); }
  }

  // apply mapping
  S.backupGroups = S.items.map(it=>({group:it.group}));
  for(const it of S.items){
    const map = mapping[it.__idx];
    if(map){
      it.group = map.main || it.group || 'General';
      it.sub_ai = map.sub || 'General';
    }else{
      const k = keywordBuckets(it);
      it.group = k.main; it.sub_ai = k.sub;
    }
  }
  buildTree(S.items); S.activeMain='All'; S.activeSub=''; S.page=1;
  $('#resetAI').style.display='inline-block';
  render();
}

/* -------------------- Boot -------------------- */
async function boot(){
  try{
    const res = await fetch('./daily.json', {cache:'no-store'});
    const j = await res.json(); S.data=j; setStatus({generated_at:j.generated_at});
    const items=[]; (j.groups||[]).forEach(g=>{
      const cat=g.name||g.category||g.group||'General';
      (g.items||[]).forEach((it,idx)=> items.push({...it, group:cat, __idx:items.length}));
    });
    S.items=items; buildTree(items); renderSidebar(); render();
  }catch(e){ console.error(e); $('#grid').innerHTML='<div class="muted">Failed to load daily.json</div>'; }
}

/* -------------------- UI wiring -------------------- */
$('#q').addEventListener('input', e=>{ S.q=e.target.value; S.page=1; render(); });
$('#sort').addEventListener('change', e=>{ S.sort=e.target.value; S.page=1; render(); });
$('#plain').addEventListener('change', e=>{ S.plain=e.target.checked; render(); });
$('#compact').addEventListener('change', e=>{ S.compact=e.target.checked; render(); });
$('#toggleAI').addEventListener('click', ()=> aiRegroup(S.items));
$('#resetAI').addEventListener('click', ()=>{
  if(!S.backupGroups) return;
  S.items.forEach((it,i)=> it.group = S.backupGroups[i].group);
  S.backupGroups=null; buildTree(S.items); S.activeMain='All'; S.activeSub=''; S.page=1;
  $('#resetAI').style.display='none'; render();
});

boot();
</script>
</body>
</html>
