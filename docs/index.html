<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Science & AI Brief</title>
  <style>
    :root{
      --bg:#0b0f14; --panel:#111826; --muted:#94a3b8; --text:#e6eef9;
      --brand:#60a5fa; --chip:#1f2937; --chip-active:#0ea5e9; --ok:#22c55e; --warn:#f59e0b;
      --card:#0f1722; --card-border:#1f2937; --pill:#0ea5e9; --link:#93c5fd; --shadow:0 6px 22px rgba(0,0,0,.35);
      --accent1:#a78bfa; --accent2:#34d399; --accent3:#f472b6; --accent4:#f59e0b; --accent5:#38bdf8;
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,#0a0f15, #0b1220 50%, #0a0f15);
      color:var(--text); font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    }
    a{color:var(--link); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      position:sticky; top:0; z-index:10;
      background:rgba(9,14,22,.7); backdrop-filter: blur(8px);
      border-bottom:1px solid #0f172a; box-shadow: var(--shadow);
    }
    .wrap{max-width:1200px; margin:0 auto; padding:18px 20px}
    .row{display:flex; gap:14px; flex-wrap:wrap; align-items:center}
    .title{font-weight:700; font-size:20px; letter-spacing:.25px}
    .muted{color:var(--muted)}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:#0b1a2a; border:1px solid #0b2b43; color:#cfe7ff; font-size:12px}
    .status{display:flex; gap:8px; align-items:center}
    .chipbar{display:flex; gap:8px; flex-wrap:wrap}
    .chip{
      background:var(--chip); color:#cbd5e1; border:1px solid #273244;
      padding:6px 10px; border-radius:999px; cursor:pointer; user-select:none; transition:.15s;
      font-size:13px
    }
    .chip[data-active="1"]{background:var(--chip-active); color:#031521; border-color:transparent; font-weight:700}
    .tools{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .input, .select, .toggle{
      background:#0b1422; border:1px solid #1e293b; color:var(--text);
      padding:10px 12px; border-radius:10px; outline:none; min-height:40px
    }
    .input{min-width:260px}
    .toggle{display:flex; align-items:center; gap:8px; cursor:pointer}
    .grid{display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin:18px 0 48px}
    @media (max-width:1100px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:720px){.grid{grid-template-columns:1fr}}
    .card{
      background:var(--card); border:1px solid var(--card-border); border-radius:var(--radius);
      padding:16px 16px 14px; box-shadow: var(--shadow);
    }
    .card h3{margin:0 0 8px; font-size:16px; line-height:1.3}
    .meta{display:flex; gap:10px; align-items:center; color:var(--muted); font-size:12px; margin-bottom:10px}
    .badge{padding:2px 8px; border-radius:999px; background:#0c2135; border:1px solid #12314d; color:#bcd7ff; font-size:11px}
    .desc{color:#c9d6e8; font-size:14px}
    .foot{margin-top:12px; display:flex; justify-content:space-between; align-items:center}
    .score{font-weight:700; color:var(--accent2)}
    .btn{
      display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:10px; font-weight:600;
      background:#0e2236; border:1px solid #16324c; color:#dbeafe; cursor:pointer
    }
    .btn:hover{background:#12304b}
    /* Highlights */
    .highlights{
      margin:18px 0 12px; padding:14px; border-radius:var(--radius);
      background:linear-gradient(135deg, rgba(14,165,233,.15), rgba(168,85,247,.15));
      border:1px solid #1f3b56;
    }
    .high-title{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.3px}
    .stars{display:flex; gap:6px}
    .stars span{width:8px;height:8px;border-radius:999px}
    .stars .s1{background:var(--accent5)} .stars .s2{background:var(--accent1)} .stars .s3{background:var(--accent2)} .stars .s4{background:var(--accent3)} .stars .s5{background:var(--accent4)}
    .high-grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-top:12px}
    @media (max-width:900px){.high-grid{grid-template-columns:1fr}}
    .high-card{
      background:#091320; border:1px solid #17314d; border-radius:14px; padding:12px 12px;
    }
    .high-card .tag{font-size:11px; color:#9cc7ff}
    .high-card .ttl{margin:4px 0; font-weight:700}
    .high-card .plain{color:#e8f3ff}
    footer{border-top:1px solid #0f1930; color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="row">
        <div class="title">üß† Science & AI Brief</div>
        <div class="status pill" id="statusPill">loading‚Ä¶</div>
        <div class="pill" id="countPill">0 items</div>
      </div>
      <div class="row" style="margin-top:10px">
        <div class="chipbar" id="chips"></div>
        <div class="tools">
          <input class="input" id="q" placeholder="Search titles & summaries‚Ä¶" />
          <select class="select" id="sort">
            <option value="score">Sort: Top score</option>
            <option value="date">Sort: Newest</option>
            <option value="alpha">Sort: A ‚Üí Z</option>
          </select>
          <label class="toggle"><input type="checkbox" id="plain" /> Plain English</label>
          <label class="toggle"><input type="checkbox" id="compact" /> Compact cards</label>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Top Highlights -->
    <section class="highlights" id="high">
      <div class="high-title">‚≠ê Top Highlights (simple takeaways)
        <div class="stars"><span class="s1"></span><span class="s2"></span><span class="s3"></span><span class="s4"></span><span class="s5"></span></div>
      </div>
      <div class="high-grid" id="highGrid"></div>
    </section>

    <!-- Cards -->
    <section class="grid" id="grid"></section>
  </main>

  <footer class="wrap muted" style="padding-bottom:40px">
    Built from <code>daily.json</code>. UI only ‚Äî pipeline untouched.
  </footer>

<script>
/* ------------- Data & rendering ------------- */
const S = {
  data: null, items: [], groups: [],
  activeCat: 'All', q:'', plain:false, compact:false, sort:'score'
};

const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

function setStatus(statusJson){
  const pill = $('#statusPill');
  if (!statusJson) { pill.textContent = 'no status'; return; }
  pill.textContent = `ok ‚Ä¢ ${statusJson.generated_at || ''}`;
}
function setCount(n){
  $('#countPill').textContent = `${n} items`;
}

/* ‚ÄúPlain English‚Äù dumb-down (rule-based, safe) */
function simplify(t){
  if (!t) return '';
  let s = String(t);
  const swaps = [
    [/state[- ]of[- ]the[- ]art/gi, 'best so far'],
    [/novel|innovative|propose|proposed/gi, 'new'],
    [/framework|architecture/gi, 'system'],
    [/benchmark(s)?/gi, 'test(s)'],
    [/dataset(s)?/gi, 'data'],
    [/significant(ly)?/gi, 'a lot'],
    [/outperform(s|ed)?/gi, 'does better than'],
    [/demonstrate(s|d)?/gi, 'shows'],
    [/achieve(s|d)?/gi, 'gets'],
  ];
  swaps.forEach(([a,b])=> s = s.replace(a,b));
  // collapse symbols
  s = s.replace(/\s+/g,' ').trim();
  // keep it short
  if (s.length > 220) s = s.slice(0, 217) + '‚Ä¶';
  return s;
}

function byScore(a,b){ return (b.score||0) - (a.score||0); }
function byDate(a,b){ return new Date(b.date||b.published||0) - new Date(a.date||a.published||0); }
function byAlpha(a,b){ return (a.title||'').localeCompare(b.title||''); }

function pickHighlights(items){
  // Choose top 6 by score, fallback to date
  const arr = [...items].sort(byScore);
  return (arr[0]?.score ? arr : [...items].sort(byDate)).slice(0,6);
}

function renderChips(categories){
  const all = ['All', ...categories];
  const el = $('#chips'); el.innerHTML = '';
  all.forEach(c=>{
    const chip = document.createElement('button');
    chip.className = 'chip'; chip.textContent = c;
    chip.dataset.active = (c===S.activeCat) ? '1' : '0';
    chip.onclick = ()=>{ S.activeCat=c; render(); };
    el.appendChild(chip);
  });
}

function makeCard(it){
  const wrap = document.createElement('article');
  wrap.className = 'card';
  if (S.compact) wrap.style.padding='12px';

  const cat = it.group || it.category || '';
  const src = it.source || it.url_domain || it.domain || '';
  const date = it.date || it.published || '';
  const score = it.score ?? (it.rank || it.points || null);
  const sum = S.plain ? simplify(it.summary || it.desc || it.abstract) : (it.summary || it.desc || it.abstract || '');

  wrap.innerHTML = `
    <div class="meta">
      <span class="badge">${cat || '‚Äî'}</span>
      ${date ? `<span class="muted">${new Date(date).toLocaleDateString()}</span>`:''}
      ${src ? `<span class="muted">‚Ä¢ ${src}</span>`:''}
    </div>
    <h3><a href="${it.url || it.link || '#'}" target="_blank" rel="noopener">${it.title || '(untitled)'}</a></h3>
    ${sum ? `<div class="desc">${sum}</div>` : ''}
    <div class="foot">
      <div class="score">${score!=null ? `Score: ${score}` : ''}</div>
      <a class="btn" href="${it.url || it.link || '#'}" target="_blank" rel="noopener">Open ‚Üó</a>
    </div>
  `;
  return wrap;
}

function renderHighlights(items){
  const hg = $('#highGrid'); hg.innerHTML = '';
  pickHighlights(items).forEach(it=>{
    const cat = it.group || it.category || '';
    const plain = simplify(it.summary || it.desc || it.abstract || it.title || '');
    const url = it.url || it.link || '#';
    const el = document.createElement('div');
    el.className = 'high-card';
    el.innerHTML = `
      <div class="tag">${cat || 'General'}</div>
      <div class="ttl"><a href="${url}" target="_blank" rel="noopener">${it.title || '(untitled)'}</a></div>
      <div class="plain">${plain}</div>
    `;
    hg.appendChild(el);
  });
}

function render(){
  // controls state
  const q = S.q.trim().toLowerCase();
  const cat = S.activeCat;

  // filter
  let list = S.items.filter(it=>{
    const inCat = (cat==='All') || ((it.group||it.category||'')===cat);
    const inQ = !q || [it.title, it.summary, it.desc, it.abstract, it.source, it.url_domain]
      .filter(Boolean).some(s => String(s).toLowerCase().includes(q));
    return inCat && inQ;
  });

  // sort
  if (S.sort==='score') list.sort(byScore);
  else if (S.sort==='date') list.sort(byDate);
  else list.sort(byAlpha);

  // render
  const grid = $('#grid'); grid.innerHTML = '';
  list.forEach(it=> grid.appendChild(makeCard(it)));

  setCount(list.length);
  renderHighlights(S.items);
  // refresh chip active states
  $$('#chips .chip').forEach(ch => ch.dataset.active = (ch.textContent===S.activeCat?'1':'0'));
}

/* ------------- Boot ------------- */
async function boot(){
  try{
    const res = await fetch('./daily.json', {cache:'no-store'});
    const j = await res.json();
    S.data = j;
    setStatus({generated_at: j.generated_at});
    // Build flat items with group
    const items = [];
    const cats = [];
    (j.groups||[]).forEach(g=>{
      const cat = g.name || g.category || g.group || 'General';
      if (!cats.includes(cat)) cats.push(cat);
      (g.items||[]).forEach(item=> items.push({...item, group:cat}));
    });
    S.groups = cats;
    S.items = items;

    renderChips(cats);
    render();
  }catch(e){
    $('#grid').innerHTML = `<div class="muted">Failed to load daily.json</div>`;
    console.error(e);
  }
}

/* ------------- UI wiring ------------- */
$('#q').addEventListener('input', e=>{ S.q = e.target.value; render(); });
$('#sort').addEventListener('change', e=>{ S.sort = e.target.value; render(); });
$('#plain').addEventListener('change', e=>{ S.plain = e.target.checked; render(); });
$('#compact').addEventListener('change', e=>{ S.compact = e.target.checked; render(); });

boot();
</script>
</body>
</html>
